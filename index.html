<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AllPlay üé∂</title>
  <style>
    :root {
      --bg: #f9f9fb;
      --text: #111;
      --accent: #ff4b5c;
      --card: #ffffff;
      --glass: rgba(255, 255, 255, 0.7);
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: var(--bg);
      color: var(--text);
    }

    nav {
      position: fixed;
      width: 100%;
      top: 0;
      background: var(--glass);
      backdrop-filter: blur(15px);
      display: flex;
      justify-content: center;
      gap: 40px;
      padding: 15px 0;
      box-shadow: var(--shadow);
      z-index: 999;
    }

    nav a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      font-size: 18px;
      position: relative;
      cursor: pointer;
    }

    nav a.active::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
      border-radius: 2px;
    }

    .page {
      display: none;
      max-width: 900px;
      margin: 100px auto 40px;
      padding: 0 20px;
    }

    .page.active {
      display: block;
    }

    h1, h2 {
      text-align: center;
      color: var(--accent);
      margin: 20px 0;
    }

    .input-group {
      position: relative;
      display: flex;
      align-items: center;
      background: var(--card);
      border-radius: 12px;
      padding: 12px 16px;
      box-shadow: var(--shadow);
      max-width: 500px;
      margin: 20px auto;
      border: 2px solid var(--accent);
    }

    .input-group::before {
      content: "üîç";
      margin-right: 10px;
      font-size: 20px;
      color: var(--accent);
    }

    .input-group input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      font-size: 16px;
      color: var(--text);
    }

    #clearSearch {
      background: none;
      border: none;
      font-size: 22px;
      color: var(--accent);
      cursor: pointer;
      padding: 0 8px;
      user-select: none;
      display: none;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background-color: #e03e4e;
    }

    .playlist-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px auto;
      max-width: 800px;
    }

    .playlist-controls input,
    .playlist-controls select,
    .playlist-controls button {
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
      outline: none;
    }

    .playlist-controls button {
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
    }

    .playlist-controls button:hover {
      background-color: #e03e4e;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: var(--card);
      border-radius: 14px;
      margin: 15px 0;
      padding: 15px;
      box-shadow: var(--shadow);
      transition: transform 0.2s ease;
      cursor: pointer;
    }

    li:hover {
      transform: translateY(-3px);
    }

    .content-row {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    li img {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      object-fit: cover;
    }

    li p {
      flex: 1;
      margin: 0;
      font-weight: 600;
      font-size: 16px;
    }

    .video-wrapper iframe {
      width: 100%;
      height: 320px;
      border: none;
      border-radius: 12px;
      margin-top: 15px;
    }

    footer {
      text-align: center;
      color: #aaa;
      margin: 60px 0 20px;
      font-size: 14px;
    }

    footer a {
      color: var(--accent);
    }

    @media (max-width: 700px) {
      .playlist-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .playlist-controls input,
      .playlist-controls select,
      .playlist-controls button {
        width: 100%;
      }

      .video-wrapper iframe {
        height: 200px;
      }
    }
  </style>
</head>
<body>

<nav>
  <a onclick="switchPage('homePage', this)" class="active">Home</a>
  <a onclick="switchPage('playlistPage', this)">Playlist</a>
</nav>

<div id="homePage" class="page active">
  <h1>AllPlay üé∂</h1>
  <div class="input-group" id="searchGroup">
    <input
      type="text"
      id="searchInput"
      placeholder="Search for music..."
      oninput="toggleClearButton()"
      onkeydown="if(event.key==='Enter'){handleSearch();}"
    />
    <button id="clearSearch" onclick="clearSearch()">√ó</button>
  </div>
  <div style="text-align:center;">
    <button onclick="handleSearch()" id="searchBtn">Search</button>
  </div>
  <ul id="results"></ul>
</div>

<div id="playlistPage" class="page">
  <h2>Your Playlist</h2>

  <div class="playlist-controls">
    <input type="text" id="newPlaylistName" placeholder="New playlist name" />
    <button onclick="createPlaylist()">Create</button>
    <select id="playlistSelector" onchange="switchPlaylist(this.value)">
      <option value="" disabled selected>Select Playlist</option>
    </select>
    <button onclick="deletePlaylist()">Delete</button>
    <button onclick="playAll()">Play All</button>
  </div>

  <ul id="playlistItems"></ul>
</div>

<footer>
  <p>
    &copy; 2025 AllPlay. Created by
    <a href="https://chrohail.org/" target="_blank">Chaudhry Rohail</a>
  </p>
</footer>

<script>
  const apiKey = "AIzaSyDHP2EWHt-9Pm4_L20lHeVt3Qotb8WYIZU";
  const resultsList = document.getElementById("results");
  const playlistItems = document.getElementById("playlistItems");
  const playlistSelector = document.getElementById("playlistSelector");
  let playlists = JSON.parse(localStorage.getItem("playlists")) || {};
  let currentPlaylist = null;
  let currentVideo = null;
  let playAllIndex = 0;

  function switchPage(id, el) {
    document.querySelectorAll(".page").forEach((p) => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll("nav a").forEach((a) => a.classList.remove("active"));
    if (el) el.classList.add("active");
  }

  function toggleClearButton() {
    const input = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearSearch");
    clearBtn.style.display = input.value.trim() ? "inline" : "none";
  }

  function clearSearch() {
    document.getElementById("searchInput").value = "";
    document.getElementById("clearSearch").style.display = "none";
    resultsList.innerHTML = "";
  }

  function createPlaylist() {
    const name = document.getElementById("newPlaylistName").value.trim();
    if (!name || playlists[name]) return alert("Enter a unique playlist name!");
    playlists[name] = [];
    localStorage.setItem("playlists", JSON.stringify(playlists));
    updatePlaylistSelector();
    document.getElementById("newPlaylistName").value = "";
  }

  function updatePlaylistSelector() {
    playlistSelector.innerHTML = '<option value="" disabled>Select Playlist</option>';
    Object.keys(playlists).forEach((name) => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      if (name === currentPlaylist) opt.selected = true;
      playlistSelector.appendChild(opt);
    });
  }

  function switchPlaylist(name) {
    currentPlaylist = name;
    updatePlaylistUI();
  }

  function deletePlaylist() {
    if (!currentPlaylist || !playlists[currentPlaylist])
      return alert("Select a playlist to delete.");
    if (!confirm(`Delete playlist "${currentPlaylist}"?`)) return;
    delete playlists[currentPlaylist];
    currentPlaylist = null;
    localStorage.setItem("playlists", JSON.stringify(playlists));
    updatePlaylistSelector();
    playlistItems.innerHTML = "";
  }

  function handleSearch() {
    const query = document.getElementById("searchInput").value.trim();
    if (!query) return alert("Enter a search term.");
    resultsList.innerHTML = "Searching...";

    fetch(
      `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(
        query
      )}&type=video&videoCategoryId=10&key=${apiKey}`
    )
      .then((res) => res.json())
      .then((data) => displayResults(data.items));
  }

  function displayResults(items) {
    resultsList.innerHTML = "";
    items.forEach((item) => {
      const li = document.createElement("li");
      const row = document.createElement("div");
      row.className = "content-row";
      row.innerHTML = `
          <img src="${item.snippet.thumbnails.default.url}" />
          <p>${item.snippet.title}</p>
          <button onclick="saveToPlaylist('${item.snippet.title.replace(
            /'/g,
            "\\'"
          )}', '${item.id.videoId}')">Save</button>
        `;
      li.appendChild(row);
      li.onclick = () => playVideoInline(li, item.id.videoId);
      resultsList.appendChild(li);
    });
  }

  function saveToPlaylist(title, videoId) {
    if (!currentPlaylist) return alert("Select a playlist first.");
    const list = playlists[currentPlaylist];
    if (list.find((song) => song.videoId === videoId))
      return alert("Already in playlist.");
    list.push({ title, videoId });
    localStorage.setItem("playlists", JSON.stringify(playlists));
    updatePlaylistUI();
  }

  function updatePlaylistUI() {
    playlistItems.innerHTML = "";
    if (!currentPlaylist || !playlists[currentPlaylist]) return;
    playlists[currentPlaylist].forEach((song, index) => {
      const li = document.createElement("li");
      const row = document.createElement("div");
      row.className = "content-row";
      row.innerHTML = `
          <img src="https://img.youtube.com/vi/${song.videoId}/default.jpg" />
          <p>${song.title}</p>
          <button onclick="removeFromPlaylist(${index})">Remove</button>
        `;
      li.appendChild(row);
      li.onclick = () => playVideoInline(li, song.videoId);
      playlistItems.appendChild(li);
    });
  }

  function removeFromPlaylist(index) {
    playlists[currentPlaylist].splice(index, 1);
    localStorage.setItem("playlists", JSON.stringify(playlists));
    updatePlaylistUI();
  }

  function playVideoInline(container, videoId) {
    if (currentVideo) currentVideo.remove();
    const wrapper = document.createElement("div");
    wrapper.className = "video-wrapper";
    wrapper.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" allowfullscreen></iframe>`;
    container.appendChild(wrapper);
    currentVideo = wrapper;
  }

  function playAll() {
    if (!currentPlaylist || !playlists[currentPlaylist].length)
      return alert("Select a playlist with videos.");
    playAllIndex = 0;
    playNextInPlaylist();
  }

  function playNextInPlaylist() {
    const song = playlists[currentPlaylist][playAllIndex];
    if (!song) return;
    const container = playlistItems.children[playAllIndex];
    playVideoInline(container, song.videoId);
    playAllIndex++;
    if (playAllIndex < playlists[currentPlaylist].length) {
      setTimeout(() => playNextInPlaylist(), 1000 * 30);
    }
  }

  updatePlaylistSelector();
</script>
</body>
</html>
